(this["webpackJsonpmesto-react-auth"]=this["webpackJsonpmesto-react-auth"]||[]).push([[0],{23:function(e,t,a){e.exports=a.p+"static/media/logo.855a8c98.svg"},25:function(e,t,a){e.exports=a.p+"static/media/win.e38b395c.svg"},26:function(e,t,a){e.exports=a.p+"static/media/loss.4072126c.svg"},29:function(e,t,a){e.exports=a(40)},34:function(e,t,a){},40:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),c=a(22),r=a.n(c),i=(a(34),a(27)),s=a(1),l=a(2),u=a(7),p=a(23),m=a.n(p),d=a(9),h=a(10),f=new(function(){function e(t){Object(d.a)(this,e),this._url=t.url,this._cohort=t.cohort,this._authorization=t.headers.authorization,this._contentType=t.headers["Content-type"]}return Object(h.a)(e,[{key:"getInfoUser",value:function(){return fetch("".concat(this._url,"/users/info"),{headers:{authorization:this._authorization,"Content-type":"".concat(this._contentType)}}).then(this._handleResponse)}},{key:"getInitialCards",value:function(){return fetch("".concat(this._url,"/cards"),{headers:{authorization:this._authorization,"Content-type":"".concat(this._contentType)}}).then(this._handleResponse)}},{key:"changeProfile",value:function(e,t){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:this._authorization,"Content-type":"".concat(this._contentType)},body:JSON.stringify({name:"".concat(e),about:"".concat(t)})}).then(this._handleResponse)}},{key:"addNewCard",value:function(e,t){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:{authorization:this._authorization,"Content-type":"".concat(this._contentType)},body:JSON.stringify({name:e,link:t})}).then(this._handleResponse).then((function(e){return e.data}))}},{key:"addLikes",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e,"/likes"),{method:"PUT",headers:{authorization:this._authorization,"Content-type":"".concat(this._contentType)}}).then(this._handleResponse).then((function(e){return e.data}))}},{key:"removeLikes",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:{authorization:this._authorization,"Content-type":"".concat(this._contentType)}}).then(this._handleResponse).then((function(e){return e.data}))}},{key:"deleteCards",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._authorization,"Content-type":"".concat(this._contentType)}}).then(this._handleResponse).then((function(e){return e.data}))}},{key:"changeAvatar",value:function(e){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:this._authorization,"Content-type":"".concat(this._contentType)},body:JSON.stringify({avatar:"".concat(e)})}).then(this._handleResponse)}},{key:"_handleResponse",value:function(e){return e.ok?e.json():(console.log("_handleResponse rejection"),Promise.reject(e.statusText))}}]),e}())({url:"https://api.pzd.students.nomoreparties.space",headers:{authorization:"Bearer ".concat(localStorage.getItem("jwt")),"Content-type":"application/json"}});var _=function(){var e=Object(l.g)(),t=Object(n.useState)(""),a=Object(s.a)(t,2),c=a[0],r=a[1];return o.a.useEffect((function(){f.getInfoUser().then((function(e){r(e.data.email)})).catch((function(e){return console.log(e.message)}))}),[c]),o.a.createElement("header",{className:"header"},o.a.createElement("img",{src:m.a,alt:"\u043b\u043e\u0433\u043e\u0442\u0438\u043f",className:"header__logo"}),o.a.createElement(l.d,null,o.a.createElement(l.b,{path:"/sign-up"},o.a.createElement(u.b,{to:"sign-in",className:"header__title"},"\u0412\u043e\u0439\u0442\u0438")),o.a.createElement(l.b,{path:"/sign-in"},o.a.createElement(u.b,{to:"sign-up",className:"header__title"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f")),o.a.createElement(l.b,{path:"/profile"},o.a.createElement("div",null,o.a.createElement("span",{className:"header__title-email"},c),o.a.createElement("button",{className:"header__button",onClick:function(){localStorage.removeItem("jwt"),e.push("/sign-in")}},"\u0412\u044b\u0439\u0442\u0438")))))},b=o.a.createContext();var E=function(e){var t=o.a.useContext(b),a=e.card,n=a.owner===t._id,c="card__button-delete ".concat(n?"":"card__button-delete_hidden"),r=a.likes.some((function(e){return e===t._id})),i="card__button ".concat(r?"card__button_active":"");return o.a.createElement("li",{className:"card"},o.a.createElement("button",{"aria-label":"delete",type:"button",className:c,onClick:e.onCardDelete}),o.a.createElement("img",{src:e.url,alt:"",className:"card__image",onClick:e.onCardClick}),o.a.createElement("div",{className:"card__restangle"},o.a.createElement("p",{className:"card__caption"},e.name),o.a.createElement("div",{className:"card__like"},o.a.createElement("button",{onClick:e.onCardLike,type:"button",className:i}),o.a.createElement("p",{className:"card__like-counter"},e.count))))};var g=function(e){return o.a.createElement("main",{className:"content"},o.a.createElement("section",{className:"profile"},o.a.createElement("button",{type:"button","aria-label":"change-avatar",className:"profile__avatar-pen",onClick:e.onEditAvatar}),o.a.createElement("img",{src:"".concat(e.userAvatar),alt:"\u0430\u0432\u0430\u0442\u0430\u0440",className:"profile__avatar"}),o.a.createElement("div",{className:"profile__info"},o.a.createElement("div",{className:"profile__string"},o.a.createElement("h1",{className:"profile__name"},e.userName),o.a.createElement("button",{type:"button","aria-label":"open",className:"profile__button-edit",onClick:e.onEditProfile})),o.a.createElement("p",{className:"profile__position"},e.userDescription)),o.a.createElement("button",{type:"button","aria-label":"add",className:"profile__button-add",onClick:e.onAddPlace})),o.a.createElement("ul",{className:"elements"},e.cards.map((function(t){return o.a.createElement(E,{card:t,onCardLike:function(){return e.handleCardLike(t)},onCardClick:function(){return e.handleCardClick(t)},onCardDelete:function(){return e.handleButtonDeleteClick(t)},key:t._id,url:t.link,name:t.name,count:t.likes.length})}))))};var v=function(){return o.a.createElement("footer",{className:"footer"},o.a.createElement("p",{className:"footer__paragraph"},"\xa9 2020 Mesto Russia"))};var N=function(e){return o.a.createElement("section",{className:"popup popup_".concat(e.name," ").concat(e.isOpen?"popup_opened":"")},o.a.createElement("div",{className:"popup__wrapper"},o.a.createElement("button",{type:"button","aria-label":"close",className:"popup__button-close popup__button-close_photo",onClick:e.onClose}),o.a.createElement("img",{src:e.url,className:"popup__image"}),o.a.createElement("h2",{className:"popup__title popup__title_open-photo"},e.title)))},C=a(16),y=a(15),O=a(14),k=function(e){Object(y.a)(a,e);var t=Object(O.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"render",value:function(){return o.a.createElement("section",{className:"popup popup_".concat(this.props.name," ").concat(this.props.isOpen?"popup_opened":"")},o.a.createElement("form",{onSubmit:this.props.onSubmit,name:this.props.name,action:"#",className:"popup__container"},o.a.createElement("button",{type:"button","aria-label":"close",className:"popup__button-close",onClick:this.props.onClose}),o.a.createElement("h2",{className:"popup__title"},this.props.title),this.props.children))}}]),a}(o.a.Component);var j=function(e){var t,a=o.a.useState(""),n=Object(s.a)(a,2),c=n[0],r=n[1],i=o.a.useState(""),l=Object(s.a)(i,2),u=l[0],p=l[1];return o.a.useEffect((function(){r(""),p("")}),[e.isOpen]),o.a.createElement(k,{name:"add-photo",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",onSubmit:function(t){t.preventDefault(),e.onAddPlace({name:c,link:u})}.bind(this),isOpen:e.isOpen,onClose:e.onClose},o.a.createElement("fieldset",{className:"popup__wrapper-input"},o.a.createElement("input",{id:"name-place",name:"place",value:c||"",onChange:function(e){r(e.target.value)},className:"popup__input",type:"text",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",required:!0}),o.a.createElement("span",{id:"name-place-error",className:"popup__error"})),o.a.createElement("fieldset",{className:"popup__wrapper-input"},o.a.createElement("input",(t={type:"url",id:"url-photo",name:"newLink",value:u||"",onChange:function(e){p(e.target.value)},className:"popup__input"},Object(C.a)(t,"type","text"),Object(C.a)(t,"placeholder","\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443"),Object(C.a)(t,"required",!0),t)),o.a.createElement("span",{id:"url-photo-error",className:"popup__error"})),o.a.createElement("button",{id:"button-create",type:"submit",className:"popup__button"},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"))};var S=function(e){var t=o.a.useContext(b),a=o.a.useState(""),n=Object(s.a)(a,2),c=n[0],r=n[1],i=o.a.useState(""),l=Object(s.a)(i,2),u=l[0],p=l[1];return o.a.useEffect((function(){r(t.name),p(t.about)}),[t]),o.a.createElement(k,{name:"edit-profile",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:c,about:u})}.bind(this),isOpen:e.isOpen,onClose:e.onClose},o.a.createElement("fieldset",{className:"popup__wrapper-input"},o.a.createElement("input",{id:"name",name:"name",value:c||"",onChange:function(e){r(e.target.value)},className:"popup__input",type:"text",placeholder:"\u0418\u043c\u044f",required:!0})),o.a.createElement("fieldset",{className:"popup__wrapper-input"},o.a.createElement("input",{id:"position",name:"position",value:u||"",onChange:function(e){p(e.target.value)},className:"popup__input",type:"text",placeholder:"\u041e \u0441\u0435\u0431\u0435",required:!0}),o.a.createElement("span",{id:"position-error",className:"popup__error"})),o.a.createElement("button",{type:"submit",className:"popup__button popup__button_profile"},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"))},w=function(e){Object(y.a)(a,e);var t=Object(O.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.onUpdateAvatar({link:this.textInput.value}),this.textInput.value=""}},{key:"render",value:function(){var e=this;return o.a.createElement(k,{name:"change-avatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",isOpen:this.props.isOpen,onClose:this.props.onClose,onSubmit:this.handleSubmit.bind(this)},o.a.createElement("fieldset",{className:"popup__wrapper-input"},o.a.createElement("input",{type:"url",ref:function(t){e.textInput=t},id:"url-avatar",name:"avatar",className:"popup__input",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0430\u0432\u0430\u0442\u0430\u0440",required:!0}),o.a.createElement("span",{id:"url-avatar-error",className:"popup__error"})),o.a.createElement("button",{id:"change-avatar-button",type:"submit",className:"popup__button"},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"))}}]),a}(o.a.Component);var z=function(e){return o.a.createElement(k,{name:"delete-card",title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onDeleteCard()}.bind(this)},o.a.createElement("button",{id:"button-delete",type:"submit",className:"popup__button popup__button_delete-card"},"\u0414\u0430"))},T=a(28),A=function(e){var t=e.component,a=Object(T.a)(e,["component"]);return o.a.createElement(l.b,null,(function(){return a.loggedIn?o.a.createElement(t,a):o.a.createElement(l.a,{to:"/sign-in"})}))},I="https://api.pzd.students.nomoreparties.space";var D=function(e){var t=Object(n.useState)(""),a=Object(s.a)(t,2),c=a[0],r=a[1],i=Object(n.useState)(""),p=Object(s.a)(i,2),m=p[0],d=p[1],h=Object(l.g)();return o.a.createElement("form",{onSubmit:function(t){t.preventDefault(),function(e,t,a,n,o){return fetch("".concat(I,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:e,email:t,name:a,about:n,avatar:o})}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){return console.log(e)}))}(m,c,"\u0416\u0430\u043a-\u0418\u0432 \u0413\u0443\u0441\u0442\u043e","\u0418\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c","https://infokotiki.ru/wp-content/uploads/2019/01/kot-spit-s-visunutim-yazikom.jpg").then((function(t){h.push("/sign-in"),e.notify(),e.popup()})).catch((function(t){console.log("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a!"),e.popup(!1)}))},autoComplete:"off",className:"user-data"},o.a.createElement("p",{className:"user-data__title"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),o.a.createElement("input",{className:"user-data__input",placeholder:"Email",type:"email",value:c,onChange:function(e){return r(e.target.value)},required:!0}),o.a.createElement("input",{className:"user-data__input",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",type:"password",value:m,onChange:function(e){return d(e.target.value)},required:!0}),o.a.createElement("button",{className:"user-data__button"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"),o.a.createElement("div",{className:"user-data__string"},o.a.createElement("span",{className:"user-data__question"},"\u0412\u044b \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"),o.a.createElement(u.b,{to:"sign-in",className:"user-data__question-button"},"\u0412\u043e\u0439\u0442\u0438")))};var P=function(e){var t=Object(n.useState)(""),a=Object(s.a)(t,2),c=a[0],r=a[1],i=Object(n.useState)(""),p=Object(s.a)(i,2),m=p[0],d=p[1],h=Object(l.g)();return o.a.createElement("form",{onSubmit:function(t){t.preventDefault(),c&&m&&function(e,t){return fetch("".concat(I,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:e,email:t})}).then((function(e){return e.json()})).then((function(e){localStorage.setItem("jwt",e.token)})).catch((function(e){return console.log(e)}))}(m,c).then((function(t){d(""),r(""),e.onAuth(),h.push("/profile")})).catch((function(e){console.log("\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a!")}))},autoComplete:"off",className:"user-data"},o.a.createElement("p",{className:"user-data__title"},"\u0412\u0445\u043e\u0434"),o.a.createElement("input",{className:"user-data__input",placeholder:"Email",type:"email",value:c,onChange:function(e){return r(e.target.value)}}),o.a.createElement("input",{className:"user-data__input",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",type:"password",value:m,onChange:function(e){return d(e.target.value)}}),o.a.createElement("button",{className:"user-data__button"},"\u0412\u043e\u0439\u0442\u0438"),o.a.createElement("div",{className:"user-data__string"},o.a.createElement("span",{className:"user-data__question"},"\u0415\u0449\u0435 \u043d\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"),o.a.createElement(u.b,{to:"sign-up",className:"user-data__question-button"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f")))};var x=function(e){return o.a.createElement("section",{className:"popup ".concat(e.isOpen?"popup_opened":"")},o.a.createElement("form",{action:"#",className:"popup__container"},o.a.createElement("button",{type:"button","aria-label":"close",className:"popup__button-close",onClick:e.onClose}),o.a.createElement("img",{src:e.image,alt:"",className:"popup__image-result"}),o.a.createElement("h2",{className:"popup__title"},e.title)))},q=a(25),L=a.n(q),R=a(26),U=a.n(R);var J=function(){var e=o.a.useState(!1),t=Object(s.a)(e,2),a=t[0],n=t[1],c=o.a.useState(!1),r=Object(s.a)(c,2),u=r[0],p=r[1],m=o.a.useState(!1),d=Object(s.a)(m,2),h=d[0],E=d[1],C=o.a.useState(!1),y=Object(s.a)(C,2),O=y[0],k=y[1],T=o.a.useState(!1),I=Object(s.a)(T,2),q=I[0],R=I[1],J=o.a.useState(!1),B=Object(s.a)(J,2),H=B[0],M=B[1],W=o.a.useState(!1),$=Object(s.a)(W,2),F=$[0],G=$[1],K=o.a.useState({}),Q=Object(s.a)(K,2),V=Q[0],X=Q[1],Y=o.a.useState({}),Z=Object(s.a)(Y,2),ee=Z[0],te=Z[1],ae=o.a.useState([]),ne=Object(s.a)(ae,2),oe=ne[0],ce=ne[1],re=o.a.useState(!1),ie=Object(s.a)(re,2),se=ie[0],le=ie[1],ue=o.a.useState(!1),pe=Object(s.a)(ue,2),me=pe[0],de=pe[1];function he(){E(!1),n(!1),p(!1),R(!1),k(!1),M(!1),G(!1)}o.a.useEffect((function(){f.getInfoUser().then((function(e){te(e.data)})).catch((function(e){console.log(e.message)}))}),[le]),o.a.useEffect((function(){f.getInitialCards().then((function(e){ce(e.data)})).catch((function(e){console.log(e.message)}))}),[le]);var fe=Object(l.g)(),_e=function(){localStorage.getItem("jwt")&&f.getInfoUser().then((function(e){e?(le(!0),fe.push("/profile")):localStorage.removeItem("jwt")}))};return o.a.useEffect((function(){_e()}),[]),o.a.createElement("div",{className:"page"},o.a.createElement(b.Provider,{value:ee},o.a.createElement(_,null),o.a.createElement(l.d,null,o.a.createElement(A,{path:"/profile",loggedIn:se,component:g,onEditAvatar:function(){E(!h)},onEditProfile:function(){n(!a)},onAddPlace:function(){p(!u)},userName:ee.name,userDescription:ee.about,userAvatar:ee.avatar,cards:oe,handleCardLike:function(e){e.likes.some((function(e){return e===ee._id}))?f.removeLikes(e._id).then((function(t){var a=oe.map((function(a){return a._id===e._id?t:a}));ce(a)})).catch((function(e){console.error(e.message)})):f.addLikes(e._id).then((function(t){var a=oe.map((function(a){return a._id===e._id?t:a}));ce(a)})).catch((function(e){console.error(e.message)}))},handleCardClick:function(e){R(!q),X(e)},handleButtonDeleteClick:function(e){k(!O),X(e)}}),o.a.createElement(l.b,{path:"/sign-in"},o.a.createElement(P,{onAuth:function(){le(!0)},tokenCheck:_e})),o.a.createElement(l.b,{path:"/sign-up"},o.a.createElement(D,{notify:function(){de(!0)},popup:function(){me?G(!F):M(!H)}})),o.a.createElement(l.b,null,o.a.createElement(l.a,{to:"/".concat(se?"profile":"sign-in")}))),o.a.createElement(w,{onUpdateAvatar:function(e){f.changeAvatar(e.link).then((function(e){te(e.data),he()})).catch((function(e){console.error(e.message)}))},isOpen:h,onClose:he}),o.a.createElement(S,{onUpdateUser:function(e){f.changeProfile(e.name,e.about).then((function(e){te(e.data)})).catch((function(e){console.error(e.message)})).finally((function(){he()}))},isOpen:a,onClose:he}),o.a.createElement(j,{onAddPlace:function(e){f.addNewCard(e.name,e.link).then((function(e){ce([e].concat(Object(i.a)(oe))),he()})).catch((function(e){console.error(e.message)}))},isOpen:u,onClose:he}),o.a.createElement(z,{onDeleteCard:function(){f.deleteCards(V._id).then((function(){var e=oe.filter((function(e){return e._id!==V._id}));ce(e),he()})).catch((function(e){console.error(e.message)}))},isOpen:O,onClose:he}),o.a.createElement(N,{name:"open-photo",url:V.link,title:V.name,isOpen:q,onClose:he}),o.a.createElement(x,{title:"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!",image:L.a,isOpen:H,onClose:he}),o.a.createElement(x,{title:"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a!\n\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.",image:U.a,isOpen:F,onClose:he}),o.a.createElement(v,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(u.a,null,o.a.createElement(J,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[29,1,2]]]);
//# sourceMappingURL=main.563e409a.chunk.js.map